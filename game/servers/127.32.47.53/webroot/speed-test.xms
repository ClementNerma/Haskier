<%\

  var i = '', dir = parseUrl('master.net/..very-big.file');
  forceStyles();
  dontResolve();

  term.set_prompt('Démarrage du téléchargement...');

  var hypernetSpeed = server.readJSON('/.sys/server.sys').networks.hypernet.speed;
  servers[dir.IP].writeFile('/webroot/..very-big.file', 'SSBhbSBhIHVzZWxlc3MgZmlsZSwgbXkgZ29hbCBpcyBqdXN0IHRvIHRlc3QgeW91ciBoeXBlcm5ldCBjb25uZWN0aW9uIDop\n'.repeat((fastdev && query['fast-network'] ? parseInt(query['fast-network']) || 16384 : hypernetSpeed) / 10));

  server.download({
    url     : dir.url,
    IP      : dir.IP ,
    progress: function(p, c, m) {
      if(i.length > 5)
        i = '';

      i += '.';
      term.set_prompt('Test de la connexion internet : ' + c + '/' + m + ' (' + Math.floor(p * 100) + '%)' + i);
    },
    success : function(ct, results) {
      display(results.size + ' octets ont été téléchagés en ' + (results.time / 1000) + ' secondes');
      display('La vitesse de votre connexion internet est donc de ' + results.speed + ' o/s');
      resolve();
    },
    error   : function(err, req) {
      display_error('Le test a échoué. Veuillez réessayer plus tard.');
      console.error('Failed to test connection speed', err, req);
      resolve();
    }
  });

  servers[dir.IP].removeFile('/webroot/..very-big.file');

%>
